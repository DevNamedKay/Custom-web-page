<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>a little something</title>
  <style>
    :root{
      --red:#b30000;
      --green:#0a7a28;
      --gold:#ffd166;
      --white:#ffffff;
      --glass-bg: rgba(255,255,255,0.06);
      --glass-border: rgba(255,255,255,0.12);
      --glass-glow: rgba(255,255,255,0.08);
    }

    html{ scroll-behavior:smooth; }
    body{
      margin:0;
      font-family:"Segoe UI", system-ui, -apple-system, Arial, sans-serif;
      color:var(--white);
      background: linear-gradient(180deg, var(--red) 0%, #8e0000 48%, var(--red) 100%);
      min-height:100vh;
      position:relative;
      overflow-x:hidden;
    }

    /* Canvas sits below content */
    #snow-canvas{ position:fixed; inset:0; z-index:0; pointer-events:none; display:block; }

    /* Piled snow bottom element (visual fallback / cover) */
    #snow-bottom{
      position:fixed; bottom:0; left:0; width:100%; height:100px; background:var(--white);
      z-index:1; transform:translateY(100px); transition:transform 0.3s ease;
    }

    #snowman-container{
      position:fixed; bottom:20px; right:20px; z-index:3; text-align:center; cursor:pointer;
    }
    #snowman-container img{ width:80px; transition:transform 0.5s ease; display:block; }
    #snowman-container span{
      display:block; color:var(--green); font-weight:bold; margin-top:5px; background:var(--gold);
      padding:4px 8px; border-radius:8px;
    }

    /* Controls cluster (top-right) */
    #controls {
      position:fixed;
      top:12px;
      right:12px;
      z-index:6;
      display:flex;
      gap:10px;
      align-items:center;
      pointer-events:auto;
      font-size:14px;
    }

    .glass-btn {
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius:12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      backdrop-filter: blur(8px) saturate(110%);
      border: 1px solid var(--glass-border);
      box-shadow: 0 6px 18px var(--glass-glow), inset 0 1px rgba(255,255,255,0.02);
      color:var(--white);
      cursor:pointer;
      font-weight:700;
      user-select:none;
      transition:transform .12s ease, box-shadow .12s ease;
    }
    .glass-btn:hover { transform:translateY(-3px); box-shadow: 0 10px 26px rgba(0,0,0,0.35); }
    .glass-btn .dot {
      width:18px; height:18px; display:inline-grid; place-items:center; border-radius:50%;
      background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.08); box-shadow:0 2px 8px rgba(0,0,0,0.35);
    }

    /* Storm button active style */
    .glass-btn[data-active="true"] {
      box-shadow: 0 10px 30px rgba(255,215,102,0.08);
      background: linear-gradient(180deg, rgba(255,215,102,0.06), rgba(255,215,102,0.02));
    }

    /* Light string across header */
    #lights {
      position: absolute;
      left: 0;
      right: 0;
      top: -8px;
      z-index: 10;
      display:flex;
      justify-content:center;
      gap:8px;
      padding:8px 12px;
      pointer-events:none;
    }
    .bulb {
      width:12px; height:18px; border-radius:4px; display:inline-block;
      box-shadow: 0 6px 18px rgba(0,0,0,0.6), 0 0 10px rgba(255,255,255,0.06) inset;
      transform-origin:center bottom;
      animation: bulb-flicker 2.6s infinite ease-in-out;
      opacity:0.98;
    }
    .bulb:nth-child(3n+1){ background: #ff3b30; animation-delay: -.2s; box-shadow: 0 6px 20px rgba(255,59,48,0.25); }
    .bulb:nth-child(3n+2){ background: #34c759; animation-delay: -.6s; box-shadow: 0 6px 20px rgba(52,199,89,0.25); }
    .bulb:nth-child(3n+3){ background: #ffd60a; animation-delay: -1s; box-shadow: 0 6px 20px rgba(255,214,10,0.25); }

    @keyframes bulb-flicker {
      0% { transform: scaleY(0.96); filter: brightness(0.95); }
      35% { transform: scaleY(1.06); filter: brightness(1.4); }
      70% { transform: scaleY(0.98); filter: brightness(0.9); }
      100% { transform: scaleY(1); filter: brightness(1); }
    }

    header{ position:relative; z-index:2; text-align:center; padding:40px 20px 20px;
            background: linear-gradient(180deg, var(--green) 0%, #075b1f 100%);
            border-bottom:4px solid var(--gold); box-shadow:0 10px 30px rgba(0,0,0,.25); }
    header h1{ margin:0 0 10px; font-size:clamp(2rem, 6vw, 3.5rem); color:var(--gold);
               text-shadow:0 2px 0 #3a2a00, 0 6px 18px rgba(0,0,0,.5); }
    header p{ margin:0; font-size:clamp(1rem, 3vw, 1.25rem); opacity:.95; }
    #countdown{ font-size:1.5rem; margin-top:15px; color:var(--white); font-weight:bold; }

    nav{ position:sticky; top:0; z-index:2; display:flex; gap:18px; justify-content:center; align-items:center;
         padding:12px 16px; background:rgba(179,0,0,.9); backdrop-filter:blur(6px); border-bottom:1px solid rgba(255,255,255,.15);} 
    nav a{ color:var(--white); text-decoration:none; font-weight:700; letter-spacing:.2px; padding:8px 14px; border-radius:999px;
           transition:transform .15s ease, background .2s ease; }
    nav a:hover{ background:rgba(255,255,255,.15); transform:translateY(-1px); }

    section{ position:relative; z-index:2; padding:60px 20px; max-width:1100px; margin:0 auto; }
    section h2{ margin:0 0 16px; font-size:clamp(1.6rem, 5vw, 2.2rem); color:var(--gold); }
    .card{ background:rgba(0,0,0,.25); border:1px solid rgba(255,255,255,.18); border-radius:16px; padding:24px; box-shadow:0 20px 40px rgba(0,0,0,.25); }
    iframe.spotify{ width:100%; height:380px; border:none; border-radius:12px; margin-top:20px; }
    .social-links a{ color:var(--gold); text-decoration:none; margin-right:15px; font-weight:bold; }

    /* Santa SVG container */
    #santa {
      position:fixed;
      top:8vh;
      left:-25vw;
      z-index:7;
      width:28vw;
      max-width:420px;
      pointer-events:none;
      transform: translateY(0);
      opacity:0;
    }
    #santa.fly {
      animation: santa-fly 4.2s cubic-bezier(.2,.8,.2,1) forwards;
    }
    @keyframes santa-fly {
      0% { left:-30vw; opacity:0; transform: translateY(-10px) rotate(-6deg) scale(0.9); }
      10% { opacity:1; }
      50% { left:50vw; transform: translateY(-28px) rotate(0deg) scale(1); }
      90% { left:110vw; transform: translateY(-6px) rotate(6deg) scale(0.95); opacity:1; }
      100% { left:120vw; opacity:0; transform: translateY(0) rotate(6deg) scale(0.9); }
    }

    footer{ position:relative; z-index:2; text-align:center; padding:30px 16px; color:rgba(255,255,255,0.85); }
  </style>
</head>
<body>
  <canvas id="snow-canvas" aria-hidden="true"></canvas>
  <div id="snow-bottom" aria-hidden="true"></div>

  <div id="snowman-container">
    <img src="images/snowman.png" alt="Snowman" id="snowman" />
    <span>double click me to get rid of snow pile!</span>
  </div>

  <!-- Controls -->
  <div id="controls">
    <button id="snow-toggle" class="glass-btn" data-on="true" aria-pressed="true" title="Toggle snow (on/off)">
      <span class="dot">‚ùÑ</span>
      <span id="snow-toggle-label">Snow: ON</span>
    </button>

    <button id="storm-btn" class="glass-btn" data-active="false" title="Toggle storm mode">
      <span class="dot">üå™</span>
      <span id="storm-label">Storm</span>
    </button>

    <button id="santa-btn" class="glass-btn" title="Send Santa flying">
      <span class="dot">üéÖ</span>
      <span>Santa!</span>
    </button>
  </div>

  <!-- Decorative lights -->
  <div id="lights" aria-hidden="true">
    <!-- generate 22 bulbs -->
    <span class="bulb"></span><span class="bulb"></span><span class="bulb"></span><span class="bulb"></span>
    <span class="bulb"></span><span class="bulb"></span><span class="bulb"></span><span class="bulb"></span>
    <span class="bulb"></span><span class="bulb"></span><span class="bulb"></span><span class="bulb"></span>
    <span class="bulb"></span><span class="bulb"></span><span class="bulb"></span><span class="bulb"></span>
    <span class="bulb"></span><span class="bulb"></span><span class="bulb"></span><span class="bulb"></span>
    <span class="bulb"></span><span class="bulb"></span>
  </div>

  <!-- Santa SVG (simple sleigh + reindeer silhouette) -->
  <div id="santa" aria-hidden="true">
    <svg viewBox="0 0 800 300" xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" preserveAspectRatio="xMidYMid meet">
      <!-- simple stylized sleigh + Santa + reindeer -->
      <g transform="translate(0,60)">
        <!-- reindeer (a simple shape to the left) -->
        <g id="reindeer" transform="translate(30,80)">
          <ellipse cx="40" cy="20" rx="22" ry="14" fill="#5b3a21"/>
          <rect x="10" y="8" width="8" height="26" rx="3" fill="#5b3a21" />
          <rect x="64" y="8" width="8" height="26" rx="3" fill="#5b3a21" />
          <circle cx="10" cy="8" r="4" fill="#5b3a21" />
          <path d="M6 2 C 2 -2, 18 -10, 34 2" stroke="#5b3a21" stroke-width="3" fill="none" stroke-linecap="round"/>
        </g>

        <!-- sleigh body -->
        <g id="sleigh" transform="translate(170,40)">
          <path d="M10 120 L50 60 L300 60 L360 120 L300 140 L60 140 Z" fill="#b30000" stroke="#6b0707" stroke-width="6"/>
          <rect x="80" y="20" width="120" height="48" rx="8" fill="#b30000" stroke="#6b0707" stroke-width="4"/>
          <circle cx="50" cy="150" r="12" fill="#333"/>
          <circle cx="310" cy="150" r="12" fill="#333"/>
          <!-- Santa (simple circle + hat) -->
          <g transform="translate(120,10)">
            <circle cx="24" cy="20" r="18" fill="#ffdbb4"/>
            <rect x="10" y="0" width="28" height="12" rx="6" fill="#c80000" />
            <circle cx="32" cy="6" r="6" fill="#fff"/>
          </g>
        </g>
      </g>
    </svg>
  </div>

  <header>
    <h1>Welcome!</h1>
    <p>Welcome and thank you!!</p>
    <div id="countdown">Loading countdown...</div>
  </header>

  <nav>
    <a href="#about">About</a>
    <a href="#music">Music</a>
    <a href="#poem">Poem</a>
    <a href="#Message">message</a>
    <a href="#contact">Contacts</a>
  </nav>

  <section id="about">
    <h2>About</h2>
    <div class="card">
      <p> Good afternoon/morning/evening. i hope whoever is reading this is having a great day. on this custom made website you can find everything at the tabs you see above! just click and it will take you to that certain section you wish. but over all i have made this website being the computer wizz i am too show my thank yours and gratefulness for everything the kind people at the community hubs have done for me. enjoy!<p>
<p> ( please note some features are either not implemented or are not working due to scripts being broken and me not having enough time to de-bug them or not having enough time to write the script in the first place, for example the little icon in the bottom right of your screen is not working properly as intended )</p>
    </div>
  </section>

  <section id="music">
    <h2>Christmas Playlist</h2>
    <div class="card">
      <p>With it being that time of year, i thought id would put this in here for you and your co-workers etc too jam to while you read :D üéÖ</p>
      <iframe class="spotify" src="https://open.spotify.com/embed/playlist/37i9dQZF1DX0Yxoavh5qJV" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>
    </div>
  </section>

  <section id="poem">
    <h2>Poem</h2>
    <div class="card">
      <p> {Before you read this please take into fact that this was made with a slight bit of humour and I do not mean to hurt anyone, this is simply for a laugh}<p>
      <p> this is about the different teams and the 'leaders' of them <p>
      <p> ___________________________________________________________________________________________<p>
<p>Since October rolled right in,</p>
<p>Work‚Äôs been wild‚Äîwhere do I begin?</p>
<p>With healthy lifestyles as our aim,</p>
<p>We livewell, yes, some day.</p>
<p>Our NL Active mornings come with "hellos" and "hi‚Äôs,"</p>
<p>as the team wakes us up, or at least they try.</p>
<p>Community wellbeing continues to grow,</p>
<p>Especially when caffeine starts to flow.</p>
<p>Then Telle keeps me steady on track,</p>
<p>then Gently nudging me when I slack.</p>
<p>Ben is the one who lifts my mood,</p>
<p>Usually with motivational food.</p>
<p>Harry‚Äôs jokes are a daily blast,</p>
<p>Even when they shouldn‚Äôt last.</p>
<p>Marie is calm. thank goodness too,</p>
<p>because she fixes half the things I do.</p>
<p>Victoria brings her office and chair,</p>
<p>with kindness, some work and a slight bit of care.</p>
<p>Julie has a great big pull,</p>
<p>and makes every fun task, mostly dull.</p>
<p>Since October, work has been great,</p>
<p>I would describe it as a Funny, lively, and a chaotic state.</p>
<p>With all the teams and all the bad weather,</p>
<p>Comes a whole lot of stories that I can tell forever.</p>
<p>____________________________________________________________________________________________________<p>

  </section>

  <section id="Message">
    <h2>My Personal Message</h2>
    <div class="card">
      <p> Hello, this is Kay. I hope all is well with you. I am writing to show how thankful I am for the experience you gave me. If I had not chosen the Community Hub, I would not have been able to do any of this or have the skills I have at the time of writing. None of it would have been possible without everyone who helped me at the Community Hub. <p>

<p> I want to thank you all for everything. You do not understand how grateful I am for everything that everyone at the Community Hubs has done‚ÄîNL Active, LiveWell, Healthy Lifestyles, Community Wellbeing, and Healthy Hearts. To everyone I have spent time with or worked with, I want to give you a huge thank you. <p>

<p> You have all been very welcoming, and I would 100% recommend my fellow interns here at Project SEARCH to give the Community Hubs a go. <p>

<p> But enough of the waffle‚Äîthank you, everyone, for your kindness and support. I wish the best for every hub in the New Year. ü•≥ü•≥ü•≥ </p>
    </div>
  </section>

  <section id="contact">
    <h2>Contact</h2>
    <div class="card">
      <p>Contact details:</p>
      <p>Email: Kaylob.dixon@northlincs.gov.uk</p>
      <p>Phone: 07511012626</p>
      <p>Webpage: https://www.facebook.com/share/17dB5PHP8f/?mibextid=wwXIfr (Note this may be blocked)<p>
      </div>
    </div>
  </section>

  <footer>
    <p>¬© 2025 Coppyright included. Made by Kaylob Dixon</p>
  </footer>

  <script>
    // Countdown Timer
    function updateCountdown(){
      const now = new Date();
      const christmas = new Date(now.getFullYear(), 11, 25);
      if(now > christmas){ christmas.setFullYear(now.getFullYear()+1); }
      const diff = christmas - now;
      const days = Math.floor(diff/(1000*60*60*24));
      const hours = Math.floor((diff/(1000*60*60))%24);
      const mins = Math.floor((diff/(1000*60))%60);
      const secs = Math.floor((diff/1000)%60);
      document.getElementById('countdown').textContent = `${days}d ${hours}h ${mins}m ${secs}s until Christmas!`;
    }
    setInterval(updateCountdown,1000);
    updateCountdown();

    // Snowman interaction
    const snowman = document.getElementById('snowman');
    if (snowman) {
      snowman.addEventListener('click', ()=>{
        snowman.style.transform = 'rotate(20deg)';
        setTimeout(()=>{ snowman.style.transform = 'rotate(-20deg)'; }, 300);
        setTimeout(()=>{ snowman.style.transform = 'rotate(0deg)'; }, 600);
      });
    }
  </script>

  <!-- Enhanced Snow + Sounds + Santa + Storm -->
  <script>
  (function () {
    // Web Audio setup (synthesized jingle / whoosh)
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const audioCtx = AudioContext ? new AudioContext() : null;

    function playBell(time = 0, duration = 0.45, baseFreq = 880) {
      if (!audioCtx) return;
      const now = audioCtx.currentTime + time;
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = 'sine';
      o.frequency.setValueAtTime(baseFreq, now);
      o.frequency.exponentialRampToValueAtTime(baseFreq * 0.5, now + duration);
      g.gain.setValueAtTime(0.0001, now);
      g.gain.exponentialRampToValueAtTime(0.6, now + 0.01);
      g.gain.exponentialRampToValueAtTime(0.001, now + duration);
      const biquad = audioCtx.createBiquadFilter();
      biquad.type = 'highpass';
      biquad.frequency.setValueAtTime(200, now);
      o.connect(biquad);
      biquad.connect(g);
      g.connect(audioCtx.destination);
      o.start(now);
      o.stop(now + duration + 0.02);
    }

    // small jingle noise for hits
    function playJingle() {
      if (!audioCtx) return;
      // a quick cluster of bells
      playBell(0, 0.26, 1100);
      playBell(0.04, 0.28, 740);
      playBell(0.08, 0.22, 1280);
    }

    function playWhoosh() {
      if (!audioCtx) return;
      const now = audioCtx.currentTime;
      const bufferSize = 2 * audioCtx.sampleRate;
      const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
      const data = buffer.getChannelData(0);
      // white-ish noise falling amplitude
      for (let i = 0; i < bufferSize; i++) {
        data[i] = (Math.random() * 2 - 1) * Math.pow(1 - i / bufferSize, 2);
      }
      const noise = audioCtx.createBufferSource();
      noise.buffer = buffer;
      const lp = audioCtx.createBiquadFilter();
      lp.type = 'lowpass';
      lp.frequency.setValueAtTime(1800, now);
      const gp = audioCtx.createGain();
      gp.gain.setValueAtTime(0.0001, now);
      gp.gain.exponentialRampToValueAtTime(0.7, now + 0.01);
      gp.gain.exponentialRampToValueAtTime(0.0001, now + 1.4);
      noise.connect(lp);
      lp.connect(gp);
      gp.connect(audioCtx.destination);
      noise.start(now);
      noise.stop(now + 1.5);
    }

    // Canvas + context
    const canvas = document.getElementById('snow-canvas');
    const ctx = canvas.getContext('2d', { alpha: true });

    // State & settings
    let W = window.innerWidth;
    let H = window.innerHeight;
    const BASE_MAX_FLAKES = Math.min(350, Math.round((W * H) / 6000));
    let MAX_FLAKES = BASE_MAX_FLAKES;
    let flakes = [];
    let running = true;
    let stormMode = false;

    // Pile (accumulation) settings
    let binWidth = 6; // width of each pile bin
    let bins = Math.ceil(W / binWidth);
    let pile = new Float32Array(bins); // heights in pixels

    // Mouse wind
    let mouseX = W/2;
    let lastMouseX = mouseX;
    let mouseWind = 0;

    // Throttle jingle to avoid frequent firing
    let lastJingle = 0;

    // Utility random
    const rand = (a,b) => Math.random()*(b-a)+a;

    function resize(){
      // preserve current pile roughly by resampling when resizing
      const oldBins = bins;
      const oldPile = pile;
      W = window.innerWidth;
      H = window.innerHeight;
      canvas.width = W;
      canvas.height = H;
      binWidth = 6;
      bins = Math.ceil(W / binWidth);
      pile = new Float32Array(bins);
      // simple resample from old pile -> new pile
      if (oldPile && oldBins) {
        for (let i=0;i<bins;i++){
          const oldIndex = Math.floor(i * oldBins / bins);
          pile[i] = oldPile[oldIndex] || 0;
        }
      }
      // adjust flakes array length to new MAX_FLAKES
      adjustFlakes();
    }
    resize();
    window.addEventListener('resize', resize);

    function createFlake(storm=false) {
      const baseR = rand(1.5, 6.0);
      const r = storm ? Math.min(10, baseR * rand(1.1, 1.9)) : baseR;
      return {
        x: rand(0, W),
        y: rand(-H, 0),
        r: r,
        speedY: rand(0.3, 1.6) * (3.5 / r) * (storm ? rand(0.9, 1.6) : 1),
        drift: rand(-0.6, 0.6),
        sway: rand(0.005, 0.02),
        phase: rand(0, Math.PI*2),
        glow: rand(0.8, 1.8) // glow intensity multiplier
      };
    }

    function populateFlakes(){
      flakes.length = 0;
      for (let i=0;i<MAX_FLAKES;i++){
        flakes.push(createFlake(stormMode));
      }
    }

    function adjustFlakes() {
      // adapt MAX_FLAKES when storm toggles or resize occurs
      MAX_FLAKES = stormMode ? Math.round(BASE_MAX_FLAKES * 1.9) : BASE_MAX_FLAKES;
      if (flakes.length < MAX_FLAKES) {
        const add = MAX_FLAKES - flakes.length;
        for (let i=0;i<add;i++) flakes.push(createFlake(stormMode));
      } else if (flakes.length > MAX_FLAKES) {
        flakes.length = MAX_FLAKES;
      }
    }

    populateFlakes();

    // draw pile as soft gradient shape
    function drawPile(){
      ctx.save();
      const g = ctx.createLinearGradient(0, H - 200, 0, H);
      g.addColorStop(0, 'rgba(255,255,255,0.85)');
      g.addColorStop(1, 'rgba(255,255,255,1)');
      ctx.fillStyle = g;
      ctx.beginPath();
      ctx.moveTo(0, H);
      const step = Math.max(1, Math.floor(bins / 300));
      for (let i=0;i<bins;i+=step){
        const x = i * binWidth;
        const h = Math.min(H * 0.6, pile[i]);
        ctx.lineTo(x, H - h);
      }
      ctx.lineTo(W, H);
      ctx.closePath();
      ctx.fill();
      ctx.restore();

      ctx.save();
      ctx.globalAlpha = 0.9;
      ctx.strokeStyle = 'rgba(255,255,255,0.65)';
      ctx.lineWidth = 1;
      ctx.beginPath();
      for (let i=0;i<bins;i++){
        const x = i * binWidth;
        const h = pile[i];
        if (i === 0) ctx.moveTo(x, H - h);
        else ctx.lineTo(x, H - h);
      }
      ctx.stroke();
      ctx.restore();
    }

    // animation loop
    let lastAnimTime = performance.now();
    function animate(now){
      if (!running) return;
      const dt = Math.min(40, now - lastAnimTime);
      lastAnimTime = now;

      // decay mouseWind slightly
      mouseWind *= 0.92;

      // clear canvas
      ctx.clearRect(0,0,W,H);

      // ambient faint glow when storm
      if (stormMode) {
        ctx.save();
        ctx.fillStyle = 'rgba(220,240,255,0.02)';
        ctx.fillRect(0,0,W,H);
        ctx.restore();
      }

      // draw snowflakes
      for (let i=0;i<flakes.length;i++){
        const f = flakes[i];

        // sway oscillation
        f.phase += f.sway * dt * 0.06;
        const swayX = Math.sin(f.phase) * f.r * 2;
        // combine drift, sway and mouse wind (wind scaled by size)
        const windEffect = (f.drift + swayX + (mouseWind * 0.06 * (1 + f.r/4)));
        // storm influence stronger drift
        const stormDriftBoost = stormMode ? (Math.sin(f.phase*1.3) * 0.6) : 0;
        f.x += (windEffect + stormDriftBoost) * (dt * 0.06);
        f.y += f.speedY * (dt * 0.06) * (1 + f.r/6) * (stormMode ? 1.25 : 1);

        // wrap horizontal edges
        if (f.x > W + 20) f.x = -20;
        if (f.x < -20) f.x = W + 20;

        // collision with pile
        const binIndex = Math.max(0, Math.min(bins-1, Math.floor(f.x / binWidth)));
        const pileTopY = H - pile[binIndex];
        if (f.y + f.r >= pileTopY) {
          // when a flake hits, increase pile at that bin (bigger flakes add more)
          const add = Math.min(26, 0.6 + f.r * (stormMode ? 1.4 : 0.9));
          pile[binIndex] = Math.min(H, pile[binIndex] + add);
          if (binIndex > 0) pile[binIndex-1] += add * 0.25;
          if (binIndex < bins-1) pile[binIndex+1] += add * 0.25;

          // sound on hit (throttle)
          const nowMs = performance.now();
          if (nowMs - lastJingle > 120) {
            lastJingle = nowMs;
            // play lighter jingle often, louder when storm
            if (Math.random() < 0.06 || stormMode) {
              playJingle();
            } else {
              // occasionally a small bell
              if (audioCtx) playBell(0, 0.22, rand(500, 1200));
            }
          }

          // reset flake to top (make storm re-created bigger/fluffier)
          flakes[i] = createFlake(stormMode);
          flakes[i].x = rand(0, W);
          flakes[i].y = rand(-40, -8);
          continue;
        }

        // draw flake with glow
        ctx.save();
        ctx.shadowColor = 'rgba(255,255,255,' + (0.06 * f.glow) + ')';
        ctx.shadowBlur = Math.min(28, f.r * 4 * f.glow);
        ctx.beginPath();
        // slight translucency for larger flakes
        ctx.fillStyle = 'rgba(255,255,255,' + (0.85 - Math.min(0.45, f.r/18)) + ')';
        ctx.arc(f.x, f.y, f.r, 0, Math.PI*2);
        ctx.fill();
        ctx.restore();
      }

      // draw pile last so it's on top near bottom
      drawPile();

      requestAnimationFrame(animate);
    }

    // Start the animation loop
    requestAnimationFrame(animate);

    // Expose a method to clear the pile
    function resetPile(){
      pile = new Float32Array(bins);
    }

    // Toggle snow on/off
    const toggleBtn = document.getElementById('snow-toggle');
    const toggleLabel = document.getElementById('snow-toggle-label');

    function setSnow(on){
      running = !!on;
      toggleBtn.setAttribute('data-on', String(!!on));
      toggleBtn.setAttribute('aria-pressed', String(!!on));
      toggleLabel.textContent = on ? 'Snow: ON' : 'Snow: OFF';
      canvas.style.display = on ? 'block' : 'none';
      document.getElementById('snow-bottom').style.transform = on ? 'translateY(100px)' : 'translateY(0)';
      if (on) {
        lastAnimTime = performance.now();
        requestAnimationFrame(animate);
      }
    }

    toggleBtn.addEventListener('click', ()=>{
      setSnow(!(toggleBtn.getAttribute('data-on') === 'true'));
    });

    // Storm button handler
    const stormBtn = document.getElementById('storm-btn');
    const stormLabel = document.getElementById('storm-label');

    function setStorm(on) {
      stormMode = !!on;
      stormBtn.setAttribute('data-active', String(!!on));
      stormLabel.textContent = on ? 'Storm: ON' : 'Storm';
      // change lighting intensity (subtle)
      document.getElementById('lights').style.opacity = on ? '1.0' : '0.95';
      // make piles settle differently
      adjustFlakes();
    }

    stormBtn.addEventListener('click', ()=>{
      setStorm(!(stormBtn.getAttribute('data-active') === 'true'));
    });

    // Mouse interaction for wind
    window.addEventListener('mousemove', (e)=>{
      mouseX = e.clientX;
      mouseWind += (mouseX - lastMouseX) * 0.02;
      lastMouseX = mouseX;
    });

    // Touch: use touchmove to create wind too
    window.addEventListener('touchmove', (e)=>{
      if (e.touches && e.touches[0]) {
        mouseX = e.touches[0].clientX;
        mouseWind += (mouseX - lastMouseX) * 0.02;
        lastMouseX = mouseX;
      }
    }, { passive: true });

    // Double-click canvas clears pile
    canvas.addEventListener('dblclick', ()=>{
      resetPile();
    });

    // Keep pile gently compacting over time (simulate settling)
    setInterval(()=>{
      for (let i=1;i<bins-1;i++){
        const left = pile[i-1], cur = pile[i], right = pile[i+1];
        const maxDiff = 1.6;
        if (cur - left > maxDiff) {
          const move = (cur - left) * 0.02;
          pile[i] -= move;
          pile[i-1] += move;
        }
        if (cur - right > maxDiff) {
          const move = (cur - right) * 0.02;
          pile[i] -= move;
          pile[i+1] += move;
        }
        pile[i] = Math.max(0, pile[i] - 0.001 * (stormMode ? 0.6 : 1));
      }
    }, 120);

    // CLEAR PILE button 
    const snowmanEl = document.getElementById('snowman');
    if (snowmanEl) {
      snowmanEl.addEventListener('dblclick', () => { resetPile(); });
    }

    // SANTA: flying across
    const santaEl = document.getElementById('santa');
    const santaBtn = document.getElementById('santa-btn');
    let santaActive = false;

    santaBtn.addEventListener('click', () => {
      if (santaActive) return; // prevent spamming
      santaActive = true;
      // resume audio context on user gesture (some browsers require)
      if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
      // play whoosh
      playWhoosh();
      // trigger animation
      santaEl.classList.remove('fly'); // reset
      // force reflow to restart animation
      void santaEl.offsetWidth;
      santaEl.classList.add('fly');
      // end handler
      santaEl.addEventListener('animationend', onSantaEnd, { once: true });
    });

    function onSantaEnd(){
      santaActive = false;
      // small jingle when Santa finishes
      playBell(0, 0.32, 640);
      // gentle burst of snow when Santa passes (spawn a short puff)
      for (let i=0;i<12;i++){
        const f = createFlake(true);
        f.x = rand(0, W);
        f.y = rand(10, 140);
        f.r *= rand(1.1, 1.6);
        flakes.push(f);
      }
      // Trim flakes array to MAX_FLAKES
      while (flakes.length > MAX_FLAKES + 60) flakes.shift();
    }

    // resume audio on first interaction if needed
    ['click','touchstart','mousemove','keydown'].forEach(ev => {
      window.addEventListener(ev, function resumeAudio() {
        if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
        window.removeEventListener(ev, resumeAudio);
      }, { passive: true });
    });

    // Ensure we start with snow enabled
    setSnow(true);

    // small helper: playBell exposed for internal use
    function playBell(delay = 0, duration = 0.25, freq = 880) {
      if (!audioCtx) return;
      const now = audioCtx.currentTime + delay;
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = 'sine';
      o.frequency.setValueAtTime(freq, now);
      o.frequency.exponentialRampToValueAtTime(freq * 0.5, now + duration);
      g.gain.setValueAtTime(0.0001, now);
      g.gain.exponentialRampToValueAtTime(0.6, now + 0.01);
      g.gain.exponentialRampToValueAtTime(0.001, now + duration);
      const biquad = audioCtx.createBiquadFilter();
      biquad.type = 'highpass';
      biquad.frequency.setValueAtTime(220, now);
      o.connect(biquad);
      biquad.connect(g);
      g.connect(audioCtx.destination);
      o.start(now);
      o.stop(now + duration + 0.02);
    }
  })();
  </script>

  <!-- End Snow + Extras -->
</body>
</html>
